<aside id="sidebar" class="window-modal">
	<header>
		<h1>Gestor Food Mobile <button class="about btn btn-primary pull-right">Sobre</button></h1>
	</header>
	<section>		
		<div id="category">
			<div id="pesquisaComanda">
				<input type="number" id="comanda" class="number emptyOnclick" name="comanda" placeholder="Comanda" >
				<input type="number" id="mesa" class="number emptyOnclick" name="mesa" placeholder="Mesa" >
				<nav class="grid" >
					<ul>
						<li><a href="#" class="loadcomanda btn btn-primary" data-type="incluirprodutos">Incluir produtos </a></li>
						<li><a href="#" class="loadcomanda btn btn-primary" data-type="verConta">Ver conta</a></li>
						<li><a href="#" class="loadcomanda btn btn-primary" data-type="transferircomanda">Transferir comanda</a></li>
					</ul>
				</nav>
			</div>
		</div>		
	<div class="logo"></div>
	</section>
	<footer id="main-footer">
		<div id="footer-options">
			<a id="btnSair" href="" class="btn btn-large" >Sair</a>
		</div>
	</footer>
</aside>
<script>
	$(document).ready(function(){
		$('.about').click(function(){
			about();
		});	
	
		$('.emptyOnclick').click(function(){
			$(this).val('');
		});
		
		//Ao clicar em uma das op��es da grid principal abre uma janela com as op��es referentes ao botao clicado
		$('.loadcomanda').click(function(){
			comanda 	= $('#comanda').val();
			mesa 		= $('#mesa').val();
			typeOption 	= $(this).attr('data-type');
			
			if(comanda == ''){
				dialog('Informe o numero da comanda!','buttonClose','OK','none');
			}else{
				//se o botao clickado for "incluir produtos" faz requisi��o dos grupos de produtos na base de dados.
				if( typeOption == 'incluirprodutos'){
					//Verifica se a comanda informada est� cadastrada na base de dados
					$.ajax({
						url : generalUrl + generalControllerUrl + '/comanda.controller.php',
						type:'POST',
						data:{'action':'verificaComanda', 'comanda' : comanda,'IP':generalIP, 'mesa':mesa},
						timeout:2000,
						beforeSend:function(){
							openLoading();
						},
						complete : function(){
							closeLoading();
						},
						success : function(data){
							closeLoading();
							if(global_debug == 'yes'){
								dialog(data,'buttonClose','OK','none');
							}
							response = JSON.parse(data);
							if(response.error == true){
								dialog(response.message,'buttonClose','OK','none');
							}else if(response.comanda != 0){
								//Requisita os grupos de produtos
								//Lista grupo de produtos, monta a janela e apresenta os dados.
								//Cria uma janela modal para aprensetar os dados					
								html = $('<div>',{
									append : [
										$('<input>',{
											'type' : 'number',
											'placeholder' : 'COD.:',
											'id' : 'produto'
										}),
										$('<button>',{
											'text' : 'OK',
											'class' : 'btn btn-large btn-success pull-right',
											click : function(event){
												event.preventDefault();
												//Ao clicar nesse botao deve enviar o codigo do produto para comanda 
												produto = $('#produto').val();
												//Valida��o: Se o produto estiver em branco retorna false
												if(produto == ''){
													dialog('Informe o codigo do produto!','buttonClose','OK','none');
													
												}else{
													//Abre janela de preferencias
													windowPreferencias(produto, comanda);
												}
											}
										}),
										$('<div>',{
											'class' : 'btn-toolbar',
											append :[
												$('<div>',{
													'class' : 'btn-group',
													append : [
														$('<a>',{
															'class' : 'btnGroups btn btn-large',
															'text' : 'Grupos',
															click : function(event){
																event.preventDefault();
																$('.btnGroups').addClass('btn-inverse');																													
																$(this).removeClass('btn-inverse');
																listaGrupoProdutos(comanda,'#grid-grupo-produtos');
															}
														}),
														$('<a>',{
															'class' : 'btnGroups btn btn-large btn-inverse',
															'text' : 'Favoritos',
															click : function(event){
																event.preventDefault();
																$('.btnGroups').addClass('btn-inverse');				
																$(this).removeClass('btn-inverse');	
																listaProdutosFavoritos(comanda,'#grid-grupo-produtos');																
															}
														}),
														$('<a>',{
															'class' : 'btnGroups btn btn-large btn-inverse',
															'text' : 'Todos',
															click : function(event){
																event.preventDefault();
																$('.btnGroups').addClass('btn-inverse');				
																$(this).removeClass('btn-inverse');
																listaTodosProdutos(comanda,'#grid-grupo-produtos');
															}
														})
													]
												})
											]
										}),
										$('<div>',{
											'id' : 'grid-grupo-produtos'
										})
									]
								});
								
								var ArrayButtons = $('<div>',{
									'class' : 'btn-group',
									append : [
										$('<a>',{
											'class' : 'btnGroups btn btn-large buttonBack',
											'text' : 'Voltar',
											click : function(event) {
												event.preventDefault();
												$('#window-modallistgrupos').remove();
											}
										}),
										$('<a>',{
											'class' : 'btnGroups btn btn-large btn-inverse',
											'text' : 'Produção',
											click : function(event){
												event.preventDefault();		
												$.ajax({
													url : generalUrl + generalControllerUrl + '/comanda.controller.php',
													type : 'POST',
													data:{'action':'enviaProducao', 'comanda' : comanda, 'mesa':mesa, 'IP': generalIP},
													timeout:2000,
													beforeSend:function(){
														openLoading();
													},
													complete : function(){
														closeLoading();
													},
													success : function(data){
														closeLoading();
														if(global_debug == 'yes'){
															dialog(data,'buttonClose','OK','none');
														}												
														response = JSON.parse(data);
														dialog(response.message,'buttonClose','OK','none');
													},
													error : function(XMLHttpRequest, textStatus, errorThrown){
														errorException(XMLHttpRequest);
													}
												})																
											}
										}),
										$('<a>',{
											'class' : 'btnGroups btn btn-large btn-inverse',
											'text' : 'Ver Itens',
											click : function(event){
												event.preventDefault();
												windowVerItensConta('verContaProdutosLancados', 'comanda.controller.php');
											}
										})										
									]
								})							

								listaGrupoProdutos(comanda,'#grid-grupo-produtos');
								
								windowModal('listgrupos', 'COMANDA: ' + comanda + ' / MESA: ' + mesa, html, 'body', 'noButtonBack', 'none', ArrayButtons);									
							}
						},
						error : function(XMLHttpRequest, textStatus, errorThrown){
							errorException(XMLHttpRequest);
						}
					});									
				}
				else if( typeOption == 'verConta' ){
					//Gera em uma janela uma lista dos produtos da comanda informada, com valores de subtotal					
					windowVerConta('verConta', 'comanda.controller.php');
				}
				else if( typeOption == 'transferircomanda' ){
					transferircomanda('transferircomanda', 'comanda.controller.php');
					// dialog('Esta função não está disponivel!','buttonClose','OK','none');
				}
			}
		});
	});
	
	function listaGrupoProdutos(comanda,containner){
		//containner = onde a grid deve ser montada.
		//cria uma grid de produtos em um local desejado
		$('#grid-grupo-produtos').empty();
		$.ajax({
			url  : generalUrl + generalControllerUrl + '/grupos.controller.php',
			type : 'POST',
			data : {'action':'listGrupos','IP':generalIP},			
			timeout : 2000,
			beforeSend: function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},			
			success : function(data){
				closeLoading();
				if(global_debug == 'yes'){
					dialog(data,'buttonClose','OK','none');
				}	
				
				response = JSON.parse(data);
				
				if(response.error == true){
					dialog(response.message,'buttonClose','OK','none');
				}
				else{
					$('#window-modallistgrupos section').css({'overflow':'none'});
					$('<nav>',{
						'id' : 'grid-grupo-produtos-nav',
						'class' : 'grid',
						append : [
							$('<ul>',{
								'id' : 'list-grupo-produtos'
							})
						],
						appendTo : containner
					});
					
					$.each(response, function(index, value){						
						$('<li>', {
							append : [
								$('<a>', {
									'href' : 'javascript:void(0)',
									'class' : 'carregaGridProdutos btn btn-success',
									'grupoId' : value.GRUPO,
									'text' : value.DESCRICAO,
									click: function(event){
										//Carrega os produtos
										listaCardapio(value.GRUPO, comanda, value.DESCRICAO.substr(0, 20));
									}
								})
							],
							appendTo: '#list-grupo-produtos'
						})			
					});
														
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){
				errorException(XMLHttpRequest);
			}
		});		
	}
	
	function listaTodosProdutos(comanda,containner){
		//containner = onde a grid deve ser montada.
		//cria uma grid de produtos em um local desejado
		$('#grid-grupo-produtos').empty();
		$.ajax({
			url  : generalUrl + generalControllerUrl + '/cardapio.controller.php',
			type : 'POST',
			data : {'action':'listaTodos','IP':generalIP},			
			timeout : 2000,
			beforeSend: function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},			
			success : function(data){
				closeLoading();
				if(global_debug == 'yes'){
					dialog(data,'buttonClose','OK','none');
				}				
				response = JSON.parse(data);
				
				if(response.error == true){
					dialog(response.message,'buttonClose','OK','none');
				}
				else{
					$('#window-modallistgrupos section').css({'overflow':'none'});
					$('<nav>',{
						'id' : 'grid-grupo-produtos-nav',
						'class' : 'grid',
						append : [
							$('<ul>',{
								'id' : 'list-grupo-produtos'
							})
						],
						appendTo : containner
					});
					
					$.each(response, function(index, value){						
						$('<li>', {
							append : [
								$('<a>', {
									'class' : 'btn btn-primary',
									'grupo' : value.GRUPO,
									'produto' : value.PRODUTO,
									'preco' :  value.PRECO,
									'style' : 'padding-left:8px;',
									click : function(event){
										event.preventDefault();
										windowPreferencias(value.PRODUTO, comanda);
									},
									append : [
										$('<em>',{
											'text' : value.PRODUTO,
											'style' : 'width:40px;margin:0 0 0 0;float:left;text-align:left;text-indent:0;font-size:0.8em;'
										}),

										$('<p>',{											
											'text' : value.DESCRICAO,
											'style' : 'width:200px;margin:0 0 0 0;float:left;text-align:left;text-indent:0;font-size:0.8em;'
										}),	

										$('<em>',{
											'text' : value.PRECO,
											'style' : 'width:50px;margin:0 0 0 0;float:right;text-align:right;text-indent:0;font-size:0.8em;'
										})
									]
								})
							],
							appendTo: '#list-grupo-produtos'
						})			
					});														
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){
				errorException(XMLHttpRequest);
			}
		});		
	}
	
	function listaProdutosFavoritos(comanda,containner){
		//containner = onde a grid deve ser montada.
		//cria uma grid de produtos em um local desejado
		//Limpa camada de produtos
		$('#grid-grupo-produtos').empty();
		$.ajax({
			url  : generalUrl + generalControllerUrl + '/cardapio.controller.php',
			type : 'POST',
			data : {'action':'listaFavoritos','IP': generalIP},			
			timeout : 2000,
			beforeSend: function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},			
			success : function(data){
				closeLoading();
				if(global_debug == 'yes'){
					dialog(data,'buttonClose','OK','none');
				}				
				response = JSON.parse(data);
				
				
				
				if(response.error == true){
					dialog(response.message,'buttonClose','OK','none');
				}
				else{
					$('#window-modallistgrupos section').css({'overflow':'none'});
					$('<nav>',{
						'id' : 'grid-grupo-produtos-nav',
						'class' : 'grid',
						append : [
							$('<ul>',{
								'id' : 'list-grupo-produtos'
							})
						],
						appendTo : containner
					});
					
					$.each(response, function(index, value){						
						$('<li>', {
							append : [
								$('<a>', {
									'class' : 'addFavorts btn btn-primary',
									'grupo' : value.GRUPO,
									'produto' : value.PRODUTO,
									'preco' :  value.PRECO,
									click : function(event){
										event.preventDefault();
										windowPreferencias(value.PRODUTO, comanda);
									},
									append : [
										$('<em>',{
											'class' : 'preco pull-left',
											'text' : value.PRODUTO
										}),	

										$('<p>',{
											'class' : 'preco pull-left',											
											'text' : value.DESCRICAO,
										}),		

										$('<em>',{
											'class' : 'preco pull-right',
											'text' : value.PRECO
										})
									]
								})
							],
							appendTo: '#list-grupo-produtos'
						})			
					});														
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){
				errorException(XMLHttpRequest);
			}
		});		
	}
	
	function listaCardapio(grupo,comanda,grupoName){
		if(global_debug == 'yes'){
			dialog('Grupo: '+grupo + 'Comanda: '+comanda,'buttonClose','OK','none');
		}
		//Busca os produtos de um determindado grupo
		$.ajax({
			url : generalUrl + generalControllerUrl + '/cardapio.controller.php',
			type : 'POST',
			data : {'action':'listaProdutos','grupo' : grupo,'IP':generalIP},
			timeout:2000,
			beforeSend : function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},				
			success : function(data){
				closeLoading();
				if(global_debug == 'yes'){
					dialog(data,'buttonClose','OK','none');
				}
				response = JSON.parse(data);
				
				if(response.error == true){
					dialog(response.message,'buttonClose','OK','none');
				}
				else{
					html = $('<nav>',{
						'id' : 'nav-cardapio',
						'class' : 'grid',
						append : [
							$('<ul>',{
								'id' : 'grid-cardapio'
							})
						]
					});
					
					//Encapula lista de cardapio em uma janela
					windowModal('gridcardapio', 'Grupo: ' + grupoName, html, 'body', 'ButtonBack', 'none','');				
					
					$.each(response, function(index, value){
						//Cria a lista de produtos
						$('<li>',{
							'class' : '',
							append : [
								$('<a>',{
									'class' : 'btn btn-primary',
									'grupo' : value.GRUPO,
									'produto' : value.PRODUTO,
									'preco' :  value.PRECO,
									append : [
										$('<em>',{'text' : value.PRODUTO}).css({'width':'13%','float':'left','text-align':'left','text-indent':0}),
										$('<em>',{'text' : value.DESCRICAO}).css({'width':'70%','float':'left','text-align':'left','text-indent':'10px'}),
										//$('<em>',{'text' : value.PRECO}).css({'width':'13%','float':'left','text-align':'left','text-indent':0})
									],
									click : function(event){
										event.preventDefault();
										windowPreferencias(value.PRODUTO, comanda);
									}
								})
							],
							appendTo : '#grid-cardapio'
						});
					});	
				}	
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){
				errorException(XMLHttpRequest);
			}
		});
	}
	function windowPreferencias(produto, comanda){
		if(global_debug == 'yes'){
			dialog('Grupo: ' + grupo + 'Produto: ' + produto + 'comanda: ' + comanda,'buttonClose','OK','none');
		}
			//Pega o grupo do produto
			$.ajax({
				url : generalUrl + generalControllerUrl + '/cardapio.controller.php',
				type : 'POST',
				data : {'action':'getDataProdutos','produto':produto,'IP':generalIP},				
				timeout : 2000,
				beforeSend: function(){
					openLoading();
				},
				complete : function(){
					closeLoading();
				},					
				success : function(data){
					closeLoading();
					if(global_debug == 'yes'){
						dialog(data,'buttonClose','OK','none');
					}
					response = JSON.parse(data);
					
					if(response.error == true){
						dialog(response.message,'buttonClose','OK','none');
					}
					else{
						$.each(response, function(index, value){
							preco   = value.PRECO;
							descricao = value.DESCRICAO;
							grupo = value.GRUPO;
						});
						
						//Retorna o id do Grupo do produto
						//Abre janela de preferencias com os parametros (grupo, produto, comanda)
						html = $('<div>',{
							append : [
								$('<strong>',{
									'text' : produto + ' ' + descricao + ' - R$ ' + preco,
								}),
								$('<form>',{
									'id' : 'enviaPreferencias',
									append : [
										$('<input>',{'type' : 'hidden', 'name' : 'action', 'value' : 'incluirProduto'}),
										$('<input>',{'type' : 'hidden', 'name' : 'produto', 'value' : produto}),
										$('<input>',{'type' : 'hidden', 'name' : 'preco', 'value' : preco}),
										$('<input>',{'type' : 'hidden', 'name' : 'descricao', 'value' : descricao}),
										$('<input>',{'type' : 'hidden', 'name' : 'mesa', 'value' : mesa}),
										$('<input>',{'type' : 'hidden', 'name' : 'comanda', 'value' : comanda}),
										$('<input>',{'type' : 'hidden', 'name' : 'garcom', 'value' : $('#garcom').attr('data-name')}),
										$('<div>',{
											'class' : 'preferenciaBox',
											append : [
												$('<a>',{
													'id' : '',
													'class' : 'btn btn-large btn-info',
													append : [
														$('<i>',{
															'class' : 'icon-white icon-minus'
														})
													],
													click : function(event){
														vlA = $('#quantidade').val();
														vlN = (vlA - 1);
														if(vlN == 0){
															$('#quantidade').val(1);
														}else{
															$('#quantidade').val(vlA - 1);
														}										
														event.preventDefault();
													}
												}),
												$('<input>',{
													'id' : 'quantidade',									
													'name' : 'quantidade',									
													'type' : 'number',
													'value' : 1,
													'width':'60%'
												}),
												$('<a>',{
													'id' : '',
													'class' : 'btn btn-large btn-info',
													append : [
														$('<i>',{
															'class' : 'icon-white icon-plus'
														})
													],
													click : function(event){
														vlA = parseInt($('#quantidade').val());
														$('#quantidade').val((vlA + 1));
														event.preventDefault();
													}										
												})
											]
										}),									
										$('<div>',{
											'class' : 'preferenciaBox',
											append :[
												$('<select>',{
													'id' : 'preferenciaA',
													'width':'65%'
												}),
												$('<a>',{
													'href' : '#',
													'class' : 'btn btn-large btn-info',
													append : [
														$('<i>',{
															'class' : 'icon-white icon-plus'
														})
													],
													click : function(event){					
														event.preventDefault();												
														//Valor da preferencia													
														vlN = $('#preferenciaA').val();
														if(vlN == 0 || vlN == '' || vlN == null){
															dialog('Escolha uma preferencia pra adicionar!','buttonClose','OK','none');
														}else{
															//Valor anterior da textarea
															vlA = $('#observacao').val();
															$('#observacao').text(vlA + vlN + '; ');
														}
													}
												})
											]
										}),
										$('<div>',{
											'class' : 'preferenciaBox',
											append :[
												$('<select>',{
													'id' : 'preferenciaB',													
													'width':'65%'
												}),
												$('<a>',{
													'href' : '#',
													'class' : 'btn btn-large btn-info',
													append : [
														$('<i>',{
															'class' : 'icon-white icon-plus'
														})
													],
													click : function(event){
														event.preventDefault();
														//Valor da preferencia
														vlN = $('#preferenciaB').val();
														if(vlN == 0 || vlN == '' || vlN == null){
															dialog('Escolha uma preferencia pra adicionar!','buttonClose','OK','none');
														}else{
															//Valor anterior da textarea
															vlA = $('#observacao').val();
															$('#observacao').text(vlA + vlN + '; ');
														}														
													}
												})
											]
										}),
										$('<div>',{
											'class' : 'preferenciaBox',
											append :[
												$('<select>',{
													'id' : 'preferenciaC',
													'width':'65%'
												}),
												$('<a>',{
													'href' : '#',
													'class' : 'btn btn-large btn-info',
													append : [
														$('<i>',{
															'class' : 'icon-white icon-plus'
														})
													],
													click : function(event){
														event.preventDefault();
														//Valor da preferencia
														vlN = $('#preferenciaC').val();
														if(vlN == 0 || vlN == '' || vlN == null){
															dialog('Escolha uma preferencia pra adicionar!','buttonClose','OK','none');
														}else{
															//Valor anterior da textarea
															vlA = $('#observacao').val();
															$('#observacao').text(vlA + vlN + '; ');
														}													
													}
												})
											]
										}),
										$('<div>',{
											'class' : 'preferenciaBox',
											append :[									
												$('<textarea>',{
													'id':'observacao', 
													'name': 'observacao',
													'readonly' : false
												}),
												$('<a>',{
													'id' : 'icon-trash',
													'href' : '#',
													'class' : 'btn btn-large btn-info',
													append : [
														$('<i>',{
															'class' : 'icon-white icon-trash'
														})
													],
													click : function(event){
														event.preventDefault();
														$('#observacao').text('');
													}
												})											
											]
										}),
										$('<button>',{
											'class' : 'btn btn-large btn-success',										
											'text' : 'Confirmar',
											'type' : 'submit'
										})
									],
									submit : function(event){
										event.preventDefault();
										quantidade = $('#quantidade').val();
										if(quantidade == 0 || quantidade < 1){
											dialog('Informe uma quantidade valida!','buttonClose','OK','none');
											$('#quantidade').val(1);
										}else{
											console.log("aqui porra");
											console.log($(this).serialize() + "&IP=" + generalIP);
											if(global_debug == 'yes'){
												observacao = $('#observacao').text();
												dialog('<br/>Descrição :'+ descricao + '<br/>Quantidade: '+ quantidade + '<br/>Preço: '+ preco + '<br/>Observacao: '+observacao,'buttonClose','OK','none');
											}
											//Envia os dados para a base de dados
											// Acho que é aqui que a porra do erro esta acontecendo.
											$.ajax({
												url:generalUrl + generalControllerUrl + '/comanda.controller.php',
												type : 'POST',
												data: $(this).serialize() + "&IP=" + generalIP,
												timeout: 2000,
												beforeSend : function(event){
													openLoading();
												},
												complete : function(){
													closeLoading();
												},													
												success : function(data){
													closeLoading();
													response = JSON.parse(data);
													dialog(response.message,'buttonClose','OK','none');
													$('#window-modalpreferencias').remove();
													$('#window-modalgridcardapio').remove();
												},
												error : function(XMLHttpRequest, textStatus, errorThrown){
													errorException(XMLHttpRequest);
												}
											})
										}
									}
								})
							]
						});
						
						//Popula os comboboxes das preferencias
						$.ajax({
							type  : 'POST',
							data : {'action':'listaPreferencias','grupo':grupo,'IP':generalIP},
							url  : generalUrl + generalControllerUrl + '/preferencias.controller.php',							
							timeout:2000,
							beforeSend: function(){
								openLoading();
							},
							complete : function(){
								closeLoading();
							},								
							success: function(data){
								closeLoading();
								if(global_debug == 'yes'){
									dialog(data,'buttonClose','OK','none');
								}						
								
								preferencias = JSON.parse(data);
								
								$.each(preferencias, function(index, value){

									var tipo = $.trim(value.TIPO);

									if(tipo == "A"){
										$('<option>', {
											text : value.DESCRICAO,
											value : value.DESCRICAO,
											appendTo : '#preferenciaA'
										});
									}
									else if(tipo == "B"){
									$('<option>', {
											text : value.DESCRICAO,
											value : value.DESCRICAO,
											appendTo : '#preferenciaB'
										});
									}
									else if(tipo == "C"){
										$('<option>', {
											text : value.DESCRICAO,
											value : value.DESCRICAO,
											appendTo : '#preferenciaC'
										});
									}
								});
							},
							error : function(XMLHttpRequest, textStatus, errorThrown){
								errorException(XMLHttpRequest);
							}
						});
						windowModal('preferencias', 'Preferencias', html, 'body','ButtonBack','none','');
					}
				},
				error : function(XMLHttpRequest, textStatus, errorThrown){
					errorException(XMLHttpRequest);
				}
			});
	}
	
	function windowModal(idWindow, title, content, containner, buttonBack, buttonOrientation, buttonAdicional){
		$('<div>',{
			'id' : 'window-modal' + idWindow,
			'class' : 'window-modal-wrap',
			append : [
				$('<div>',{					
					'class' : 'window-modal',
					append : [
						//Cabecalho da janela
						$('<header>',{
							append : [
								$('<h1>',{
									'text' : title
								})
							]
						}),						
						$('<section>').append(content)
					]
				})
			],
			appendTo : containner
		});
		
		if(buttonBack == 'noButtonBack'){
			$('<footer>',{
				append : [
					$('<div>',{
						'class':'',
						'id':'footer'
					}).append(buttonAdicional)
				],
				appendTo : '#window-modal' + idWindow + ' div.window-modal'
			});
		}else if(buttonBack == 'ButtonBack'){
			$('<footer>',{
				append :[
					$('<div>',{
					    'id': 'footer',
						'style' : 'float:left;width:90%;text-align:center',
						append : [
							$('<button>', {
								'style':'margin:0 10px;',
								'class' : 'btn btn-large btn-inverse',																					
								'text' : 'Voltar',
								click: function(event){
									event.preventDefault();
									$('#window-modal' + idWindow).remove();
								}
							}).css({'float':buttonOrientation}),
							$('<span>').append(buttonAdicional)
						]
					})
				],
				appendTo : '#window-modal' + idWindow + ' div.window-modal'
			})
		}
	}
	function windowVerConta(action, controller){
		$.ajax({
			url : generalUrl + generalControllerUrl + '/' + controller,
			type : 'POST',
			data : {'action' : action, 'comanda' : comanda, 'IP': generalIP, 'mesa': mesa},
			timeout : 2000,
			beforeSend : function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},						
			success : function(data){
				closeLoading();
				if(global_debug == 'yes'){
					dialog(data,'buttonClose','OK','none');
				}
				response = JSON.parse(data);
				
				if(response.error == "true"){
					dialog(response.message,'buttonClose','OK','none');
				}
				else{								
					html = $('<nav>',{
						'class' : 'grid',
						'id' : 'grid-conta',
						append : [
							$('<div>',{
								'id' : 'grid-conta-header',
								'class' : 'btn btn-inverse',
								append : [
									$('<em>',{'text' : 'Descrição'}).css({'width':'60%','float':'left','text-align':'left','text-indent':'10px'}),
									$('<em>',{'text' : 'Qtd'}).css({'width':'13%','float':'left','text-align':'left','text-indent':0}),
									$('<em>',{'text' : 'Preço'}).css({'width':'13%','float':'left','text-align':'left','text-indent':0}),
									$('<em>',{'text' : 'Total'}).css({'width':'14%','float':'left','text-align':'left','text-indent':0})
								]
							}),
							$('<ul>', {
								'id' : 'grid-conta-body'
							}),
						]
					}).css({'font-size':'0.7em'});
					
					var QTD_TOTAL;
					var VALOR_TOTAL;
					if(response.error == "true"){
						QTD_TOTAL = "0.00";
						VALOR_TOTAL = "0.00";
					}else{
						QTD_TOTAL = response.totais.QTD_TOTAL;
						VALOR_TOTAL = response.totais.VALOR_TOTAL;
					}
						
					arrayButton = $('<div>',{
						'id' : 'grid-conta-footer',
						'class' : 'btn btn-inverse',
						append : [
							$('<em>',{'text' : 'QTD itens: ' + QTD_TOTAL}),										
							$('<em>',{'text' : 'Total conta: R$ ' + VALOR_TOTAL})													
						],
						click : function (event){
							//Funcao para imprimir a conta
							event.preventDefault();
							$.ajax({
								url : generalUrl + generalControllerUrl + '/comanda.controller.php',
								type : 'POST',
								data:{'action':'imprimirConta','comanda':comanda, 'IP': generalIP},
								timeout : 2000,
								beforeSend : function(){
									openLoading();
								},
								complete : function(){
									closeLoading();
								},						
								success : function(data){	
									closeLoading();
									if(global_debug == 'yes'){
										dialog(data,'buttonClose','OK','none');
									}
									response = JSON.parse(data);
				
									dialog(response.message,'buttonClose','OK','none');											
								},
								error : function(XMLHttpRequest, textStatus, errorThrown){
									errorException(XMLHttpRequest);
								}
							});
						}
					});
															
					//Cria janela com os dados da conta
					windowModal('conta', 'Conta Comanda: '+comanda, html, 'body', 'ButtonBack', 'center', arrayButton);
					
					//Popula a lista de itens
					$.each(response.produtos, function(index, value){
						$('<li>',{
							'class' : 'grid-zebra',
							append : [
								$('<a>', {
									'href' : '#',
									'class' : 'btn',
									'impresso' : value.IMPRESSO,
									'nitem' : value.NITEM,

									append : [
										$('<em>',{'text' : value.DESCRICAO}).css({'width':'60%','float':'left','text-align':'left','text-indent':'10px'}),
										$('<em>',{'text' : value.QUANTIDADE}).css({'width':'13%','float':'left','text-align':'left','text-indent':0}),
										$('<em>',{'text' : value.PRECO_UNIT}).css({'width':'13%','float':'left','text-align':'left','text-indent':0}),
										$('<em>',{'text' : value.VALOR_TOTAL_PRODUTO}).css({'width':'13%','float':'left','text-align':'left','text-indent':0})
									]
								})
							],
							appendTo : '#grid-conta-body'
						})
					});	
																					
					$('#grid-conta-body li a:odd').addClass('btn-info');
				}				
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){
				errorException(XMLHttpRequest);
			}
		})
	}
	
	function windowVerItensConta(action, controller){
		$.ajax({
			url : generalUrl + generalControllerUrl + '/' + controller,
			type : 'POST',
			data : {'action' : action, 'comanda' : comanda, 'IP': generalIP},
			timeout : 2000,
			beforeSend : function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},						
			success : function(data){
				closeLoading();
				if(global_debug == 'yes'){
					dialog(data,'buttonClose','OK','none');
				}
				response = JSON.parse(data);
				
				if(response.error == "true"){
					dialog(response.message,'buttonClose','OK','none');
				}
				else{								
					html = $('<nav>',{
						'class' : 'grid',
						'id' : 'grid-conta',
						append : [
							$('<div>',{
								'id' : 'grid-conta-header',
								'class' : 'btn btn-inverse',
								append : [
									$('<em>',{'text' : 'Codigo'}).css({'width':'13%','float':'left','text-align':'left','text-indent':0}),
									$('<em>',{'text' : 'Descrição'}).css({'width':'74%','float':'left','text-align':'left','text-indent':'10px'}),
									$('<em>',{'text' : 'QTD'}).css({'width':'13%','float':'left','text-align':'left','text-indent':0})
								]
							}),
							$('<ul>', {
								'id' : 'grid-conta-body'
							}),
						]
					}).css({'font-size':'0.7em'});
					
					var QTD_TOTAL;
					if(response.error == "true"){
						QTD_TOTAL = "0.00";
					}else{
						QTD_TOTAL = response.totais.QTD_TOTAL;
					}
						
					arrayButton = $('<div>',{
						'id' : 'grid-conta-footer',
						'class' : 'btn btn-inverse',
						append : [
							$('<em>',{'text' : 'QTD itens: ' + QTD_TOTAL}),										
							$('<em>',{'text' : 'Enviar produção'})													
						],
						click : function (event){
							//Funcao para imprimir a conta
							event.preventDefault();
							$.ajax({
								url : generalUrl + generalControllerUrl + '/comanda.controller.php',
								type : 'POST',
								data:{'action':'enviaProducao', 'comanda' : comanda, 'mesa':mesa, 'IP': generalIP},
								timeout:2000,
								beforeSend:function(){
									openLoading();
								},
								complete : function(){
									closeLoading();
								},
								success : function(data){
									closeLoading();
									if(global_debug == 'yes'){
										dialog(data,'buttonClose','OK','none');
									}												
									response = JSON.parse(data);
									dialog(response.message,'buttonClose','OK','none');
								},
								error : function(XMLHttpRequest, textStatus, errorThrown){
									errorException(XMLHttpRequest);
								}
							});
						}
					});
															
					//Cria janela com os dados da conta
					windowModal('conta', 'Conta Comanda: '+comanda, html, 'body', 'ButtonBack', 'center', arrayButton);
					
					//Popula a lista de itens
					$.each(response.produtos, function(index, value){
						$('<li>',{
							'class' : 'grid-zebra',
							append : [
								$('<a>', {
									'href' : '#',
									'class' : 'btn',
									'nitem' : value.NITEM,

									append : [
										$('<em>',{'text' : value.PRODUTO}).css({'width':'13%','float':'left','text-align':'left','text-indent':'10px'}),
										$('<em>',{'text' : value.DESCRICAO}).css({'width':'74%','float':'left','text-align':'left','text-indent':0}),
										$('<em>',{'text' : value.QUANTIDADE}).css({'width':'13%','float':'left','text-align':'left','text-indent':0})
									],
									
									click : function(event){
										nitem = $(this).attr('nitem');

										event.preventDefault();
										arrayContent = $('<div>',{
											'class':'list-container',
											append : [												
												$('<div>',{
													'class':'list-content',
													append:[
														$('<ul>',{
															'class':'list-vertical',
															append:[
																$('<li>',{text: value.DESCRICAO.substr(0, 35)}).css({'width':'100%'}),
																$('<li>',{text:'Preço: '+value.PRECO_UNIT}),
																$('<li>',{text:'Quantidade: '+value.QUANTIDADE}),
																$('<li>',{text:'Data: '+value.DATA}),
																$('<li>',{text:'Hora: '+value.HORA})
															]
														})
													]
												}),
												$('<select>',{
													'id' : '',
													append : [
														$('<option>',{
															'text' : 'Opções',
															'value' : 0,
														}),
														$('<option>',{
															'text' : 'Cancelar',
															'value' : 3,
														})
													],
													change : function(){
														//Define a função a ser executada quando selecionar uma opção do combobox				
														$.ajax({
															url :  generalUrl + generalControllerUrl + '/comanda.controller.php',
															type : 'POST',
															data : {'action':'opcoesConta','garcom':$('#garcom').attr('data-name'),'option':$(this).val(),'nitem':nitem,'comanda':comanda, 'IP':generalIP},
															timeout : 2000,
															beforeSend : function(){
																openLoading();
															},
															complete : function(){
																closeLoading();
															},																
															success : function(data){
																closeLoading();
																if(global_debug == 'yes'){
																	dialog(data,'buttonClose','OK','none');
																}
																response = JSON.parse(data);																																
																
																//Exibe informa褯 de retorno
																botao = $('<a>',{
																			'class' : 'btn btn-large btn-inverse',
																			'text' : 'OK',
																			'href' : '#',
																			click : function(event){
																				event.preventDefault();
																				//recria janela com dados da conta
																				$('#window-modalconta').remove();
																				windowVerItensConta(action, controller);
																				
																				$('#dialog').remove();
																			}
																})
																
																dialog(response.message,botao,'OK','none');
															},
															error : function(XMLHttpRequest, textStatus, errorThrown){
																errorException(XMLHttpRequest);
															}																
														});
													}
												})
											]										
										})
										
										//Abre janela com as opções 
										dialog(arrayContent,'buttonClose','Voltar','left');													
									}
								})
							],
							appendTo : '#grid-conta-body'
						})
					});	
																					
					$('#grid-conta-body li a:odd').addClass('btn-info');
				}				
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){
				errorException(XMLHttpRequest);
			}
		})
	}

	function transferircomanda(action, controller){
		$.ajax({
			url : generalUrl + generalControllerUrl + '/' + controller,
			type : 'POST',
			data : {'action' : action, 'comanda' : comanda, 'IP': generalIP},
			timeout : 2000,
			beforeSend : function(){
				openLoading();
			},
			complete : function(){
				closeLoading();
			},						
			success : function(data){

			}
		}
	}
</script>